const toggleThemeBtn=document.querySelector(".header__theme-button"),storiesContent=document.querySelector(".stories__content"),storiesLeftButton=document.querySelector(".stories__left-button"),storiesRightButton=document.querySelector(".stories__right-button"),posts=document.querySelectorAll(".post"),postsContent=document.querySelectorAll(".post__content");let last=+new Date;if(toggleThemeBtn.addEventListener("click",()=>{document.documentElement.classList.toggle("darkTheme"),document.documentElement.classList.contains("darkTheme")?localStorage.setItem("theme","dark"):localStorage.setItem("theme","light")}),storiesLeftButton.addEventListener("click",()=>{storiesContent.scrollLeft-=320}),storiesRightButton.addEventListener("click",()=>{storiesContent.scrollLeft+=320}),window.matchMedia("(min-width: 1024px)").matches){let e=new IntersectionObserver(function(e){e.forEach(e=>{e.target===document.querySelector(".story:first-child")?storiesLeftButton.style.display=e.isIntersecting?"none":"unset":e.target===document.querySelector(".story:last-child")&&(storiesRightButton.style.display=e.isIntersecting?"none":"unset")})},{root:storiesContent,threshold:1}),t=document.querySelector(".story:first-child"),o=document.querySelector(".story:last-child");t&&e.observe(t),o&&e.observe(o)}posts.forEach(e=>{var t;if(e.querySelectorAll(".post__media").length>1){let o=document.createElement("button");o.setAttribute("title","leftwards"),o.classList.add("post__left-button"),o.innerHTML=`
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
    <path fill="#fff" d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zM142.1 273l135.5 135.5c9.4 9.4 24.6 9.4 33.9 0l17-17c9.4-9.4 9.4-24.6 0-33.9L226.9 256l101.6-101.6c9.4-9.4 9.4-24.6 0-33.9l-17-17c-9.4-9.4-24.6-9.4-33.9 0L142.1 239c-9.4 9.4-9.4 24.6 0 34z"></path>
  </svg>
`;let s=document.createElement("button");s.setAttribute("title","rightwards"),s.classList.add("post__right-button"),s.innerHTML=`
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
    <path fill="#fff" d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zm113.9 231L234.4 103.5c-9.4-9.4-24.6-9.4-33.9 0l-17 17c-9.4 9.4-9.4 24.6 0 33.9L285.1 256 183.5 357.6c-9.4 9.4-9.4 24.6 0 33.9l17 17c9.4 9.4 24.6 9.4 33.9 0L369.9 273c9.4-9.4 9.4-24.6 0-34z"></path>
  </svg>
`,e.querySelector(".post__content").appendChild(o),e.querySelector(".post__content").appendChild(s),e.querySelectorAll(".post__media").forEach(function(t,o){let s=document.createElement("div");s.classList.add("post__indicator"),0==o&&s.classList.add("post__indicator--active"),e.querySelector(".post__indicators").appendChild(s)});let r=e.querySelector(".post__medias"),l=e.querySelectorAll(".post__indicator"),n=new IntersectionObserver(function(e){e.forEach(e=>{e.isIntersecting&&(l.forEach(e=>e.classList.remove("post__indicator--active")),l[Array.from(c).indexOf(e.target)].classList.add("post__indicator--active"))})},{root:r,threshold:.5}),c=e.querySelectorAll(".post__media");c.forEach((e,t)=>{n.observe(e)})}e.querySelectorAll(".post__comment-form").forEach(t=>{t.onsubmit=function(o){o.preventDefault();let s=+new Date;if(!(s-last<5e3)){last=s;var r=new FormData(t);t.reset();var l=e.querySelector(".post__comments");l.style.display="",fetch(t.action,{method:"POST",body:r}).then(e=>{if(e.ok)return e.json();throw Error("get comments failed")}).then(e=>{if(!0==e.success){for(var t=l.querySelector("ul");t.firstChild;)t.removeChild(t.lastChild);e.items.forEach(e=>{var o=document.createElement("li"),s=document.createElement("strong");s.textContent=e.name,o.appendChild(s);var r=document.createElement("span");r.textContent=e.content,o.appendChild(r),t.appendChild(o)}),l.className=l.className.replace("is-loading","is-loaded"),t.scrollTop=t.scrollHeight}else!1==e.success&&(l.style.display="none")}).catch(e=>{l.style.display="none"})}}})}),postsContent.forEach(e=>{if(e.querySelectorAll(".post__media").length>1){let t=e.querySelector(".post__left-button"),o=e.querySelector(".post__right-button"),s=e.querySelector(".post__medias");t.addEventListener("click",()=>{s.scrollLeft-=400}),o.addEventListener("click",()=>{s.scrollLeft+=400});let r=new IntersectionObserver(function(s){s.forEach(s=>{s.target===e.querySelector(".post__media:first-child")?t.style.display=s.isIntersecting?"none":"unset":s.target===e.querySelector(".post__media:last-child")&&(o.style.display=s.isIntersecting?"none":"unset")})},{root:s,threshold:.5});window.matchMedia("(min-width: 1024px)").matches&&(r.observe(e.querySelector(".post__media:first-child")),r.observe(e.querySelector(".post__media:last-child")))}});var like_checkboxes=document.querySelectorAll(".post__footer .post__buttons .post__button .checkbox");for(let i=0;i<like_checkboxes.length;i++)like_checkboxes[i].addEventListener("change",function(){if(this.checked){var e=this.closest(".post__footer").querySelector(".post__likes .number_like");e.innerText=Number(e.innerText)+1}else{var e=this.closest(".post__footer").querySelector(".post__likes .number_like");e.innerText=Number(e.innerText)-1}});const searchFormDesktop=document.getElementById("searchFormDesktop");searchFormDesktop&&searchFormDesktop.addEventListener("submit",handleSearchFormSubmit);const searchFormMobile=document.getElementById("searchFormMobile");function IsImageOk(e){return!!e.complete&&!(!e.naturalWidth>0)}function copyLink(e){var t=e.closest(".post"),o=t.querySelector(".post__more-options").href;navigator.clipboard.writeText(o).then(function(){console.log("Link copied to clipboard!");var e=document.createElement("div");e.classList.add("copy-success-message"),e.textContent="Link Copied!",t.appendChild(e),setTimeout(function(){t.removeChild(e)},2e3)},function(e){console.error("Could not copy link: ",e)})}function showComments(e){var t=e.closest(".post__footer"),o=t.querySelector(".post__comments");if("none"===o.style.display){o.style.display="";var s=o.querySelector("ul");if(s.querySelector("li"))return;var r=t.querySelector(".post__comment-form");fetch("/Comment",{method:"POST",body:new FormData(r)}).then(e=>{if(e.ok)return e.json();throw Error("get comments failed")}).then(e=>{if(!0==e.success){if(o.className=o.className.replace("is-loading","is-loaded"),!e.items||e.items.length<1){var t=document.createElement("li"),r=document.createElement("span");r.textContent="还没有评论，赶快评论吧",t.appendChild(r),s.appendChild(t);return}e.items.forEach(e=>{var t=document.createElement("li"),o=document.createElement("strong");o.textContent=e.name,t.appendChild(o);var r=document.createElement("span");r.textContent=e.content,t.appendChild(r),s.appendChild(t)})}else e.success}).catch(e=>{o.style.display="none"})}else o.style.display="none"}function handleSearchFormSubmit(e){e.preventDefault();let t=e.target.querySelector('input[name="tagName"]').value.trim();if(t){let o=encodeURIComponent(t);window.location.href=`/tag/${o}/page/1`}else window.location.href="/"}searchFormMobile&&searchFormMobile.addEventListener("submit",handleSearchFormSubmit),document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".post .post__content .post__medias .post__media:first-child img").forEach(e=>{if(e.addEventListener("load",()=>{let t=e.closest(".is-loading");t&&t.classList.remove("is-loading")}),e.complete&&(e.naturalWidth>0||e.naturalHeight>0)){let t=e.closest(".is-loading");t&&t.classList.remove("is-loading")}})});