function IsImageOk(n){return!n.complete||!n.naturalWidth>0?!1:!0}function copyLink(n){var t=n.closest(".post"),i=t.querySelector(".post__more-options").href;navigator.clipboard.writeText(i).then(function(){console.log("Link copied to clipboard!");var n=document.createElement("div");n.classList.add("copy-success-message");n.textContent="Link Copied!";t.appendChild(n);setTimeout(function(){t.removeChild(n)},2e3)},function(n){console.error("Could not copy link: ",n)})}function showComments(n){var r=n.closest(".post__footer"),t=r.querySelector(".post__comments"),i,u,f;if("none"===t.style.display){if(t.style.display="",i=t.querySelector("ul"),i.querySelector("li"))return;u=r.querySelector(".post__comment-form");f=new FormData(u);const n={method:"POST",body:f};fetch("/Comment",n).then(n=>{if(n.ok)return n.json();throw new Error("get comments failed");}).then(n=>{if(n.success==!0){if(t.className=t.className.replace("is-loading","is-loaded"),!n.items||n.items.length<1){var r=document.createElement("li"),u=document.createElement("span");u.textContent="还没有评论，赶快评论吧";r.appendChild(u);i.appendChild(r);return}n.items.forEach(n=>{var t=document.createElement("li"),u=document.createElement("strong"),r;u.textContent=n.name;t.appendChild(u);r=document.createElement("span");r.textContent=n.content;t.appendChild(r);i.appendChild(t)})}else n.success==!1}).catch(()=>{t.style.display="none"})}else t.style.display="none"}function handleSearchFormSubmit(n){n.preventDefault();const i=n.target,r=i.querySelector('input[name="tagName"]'),t=r.value.trim();if(t){const n=encodeURIComponent(t);window.location.href=`/tag/${n}/page/1`}else window.location.href="/"}const toggleThemeBtn=document.querySelector(".header__theme-button"),storiesContent=document.querySelector(".stories__content"),storiesLeftButton=document.querySelector(".stories__left-button"),storiesRightButton=document.querySelector(".stories__right-button"),posts=document.querySelectorAll(".post"),postsContent=document.querySelectorAll(".post__content");let last=+new Date;if(toggleThemeBtn.addEventListener("click",()=>{document.documentElement.classList.toggle("darkTheme"),document.documentElement.classList.contains("darkTheme")?localStorage.setItem("theme","dark"):localStorage.setItem("theme","light")}),storiesLeftButton.addEventListener("click",()=>{storiesContent.scrollLeft-=320}),storiesRightButton.addEventListener("click",()=>{storiesContent.scrollLeft+=320}),window.matchMedia("(min-width: 1024px)").matches){const n=new IntersectionObserver(function(n){n.forEach(n=>{n.target===document.querySelector(".story:first-child")?storiesLeftButton.style.display=n.isIntersecting?"none":"unset":n.target===document.querySelector(".story:last-child")&&(storiesRightButton.style.display=n.isIntersecting?"none":"unset")})},{root:storiesContent,threshold:1});let t=document.querySelector(".story:first-child"),i=document.querySelector(".story:last-child");t&&n.observe(t);i&&n.observe(i)}posts.forEach(n=>{if(n.querySelectorAll(".post__media").length>1){const t=document.createElement("button");t.setAttribute("title","leftwards");t.classList.add("post__left-button");t.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
        <path fill="#fff" d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zM142.1 273l135.5 135.5c9.4 9.4 24.6 9.4 33.9 0l17-17c9.4-9.4 9.4-24.6 0-33.9L226.9 256l101.6-101.6c9.4-9.4 9.4-24.6 0-33.9l-17-17c-9.4-9.4-24.6-9.4-33.9 0L142.1 239c-9.4 9.4-9.4 24.6 0 34z"></path>
      </svg>
    `;const i=document.createElement("button");i.setAttribute("title","rightwards");i.classList.add("post__right-button");i.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
        <path fill="#fff" d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zm113.9 231L234.4 103.5c-9.4-9.4-24.6-9.4-33.9 0l-17 17c-9.4 9.4-9.4 24.6 0 33.9L285.1 256 183.5 357.6c-9.4 9.4-9.4 24.6 0 33.9l17 17c9.4 9.4 24.6 9.4 33.9 0L369.9 273c9.4-9.4 9.4-24.6 0-34z"></path>
      </svg>
    `;n.querySelector(".post__content").appendChild(t);n.querySelector(".post__content").appendChild(i);n.querySelectorAll(".post__media").forEach(function(t,i){const r=document.createElement("div");r.classList.add("post__indicator");0==i&&r.classList.add("post__indicator--active");n.querySelector(".post__indicators").appendChild(r)});const f=n.querySelector(".post__medias"),r=n.querySelectorAll(".post__indicator"),e=new IntersectionObserver(function(n){n.forEach(n=>{n.isIntersecting&&(r.forEach(n=>n.classList.remove("post__indicator--active")),r[Array.from(u).indexOf(n.target)].classList.add("post__indicator--active"))})},{root:f,threshold:.5}),u=n.querySelectorAll(".post__media");u.forEach(n=>{e.observe(n)})}var t=n.querySelectorAll(".post__comment-form");t.forEach(t=>{t.onsubmit=function(i){var f,r;i.preventDefault();const u=+new Date;if(!(u-last<5e3)){last=u;f=new FormData(t);t.reset();r=n.querySelector(".post__comments");r.style.display="";const e={method:"POST",body:f};fetch(t.action,e).then(n=>{if(n.ok)return n.json();throw new Error("get comments failed");}).then(n=>{if(n.success==!0){for(var t=r.querySelector("ul");t.firstChild;)t.removeChild(t.lastChild);n.items.forEach(n=>{var i=document.createElement("li"),u=document.createElement("strong"),r;u.textContent=n.name;i.appendChild(u);r=document.createElement("span");r.textContent=n.content;i.appendChild(r);t.appendChild(i)});r.className=r.className.replace("is-loading","is-loaded");t.scrollTop=t.scrollHeight}else n.success==!1&&(r.style.display="none")}).catch(()=>{r.style.display="none"})}}})});postsContent.forEach(n=>{if(n.querySelectorAll(".post__media").length>1){const i=n.querySelector(".post__left-button"),r=n.querySelector(".post__right-button"),t=n.querySelector(".post__medias");i.addEventListener("click",()=>{t.scrollLeft-=400});r.addEventListener("click",()=>{t.scrollLeft+=400});const u=new IntersectionObserver(function(t){t.forEach(t=>{t.target===n.querySelector(".post__media:first-child")?i.style.display=t.isIntersecting?"none":"unset":t.target===n.querySelector(".post__media:last-child")&&(r.style.display=t.isIntersecting?"none":"unset")})},{root:t,threshold:.5});window.matchMedia("(min-width: 1024px)").matches&&(u.observe(n.querySelector(".post__media:first-child")),u.observe(n.querySelector(".post__media:last-child")))}});var like_checkboxes=document.querySelectorAll(".post__footer .post__buttons .post__button .checkbox");for(let n=0;n<like_checkboxes.length;n++)like_checkboxes[n].addEventListener("change",function(){var n;this.checked?(n=this.closest(".post__footer").querySelector(".post__likes .number_like"),n.innerText=Number(n.innerText)+1):(n=this.closest(".post__footer").querySelector(".post__likes .number_like"),n.innerText=Number(n.innerText)-1)});const searchFormDesktop=document.getElementById("searchFormDesktop");searchFormDesktop&&searchFormDesktop.addEventListener("submit",handleSearchFormSubmit);const searchFormMobile=document.getElementById("searchFormMobile");searchFormMobile&&searchFormMobile.addEventListener("submit",handleSearchFormSubmit);document.addEventListener("DOMContentLoaded",function(){const n=document.querySelectorAll(".post .post__content .post__medias .post__media:first-child img");n.forEach(n=>{if(n.addEventListener("load",()=>{const t=n.closest(".is-loading");t&&t.classList.remove("is-loading")}),n.complete&&(n.naturalWidth>0||n.naturalHeight>0)){const t=n.closest(".is-loading");t&&t.classList.remove("is-loading")}})});